<div class="sidebar-brand{% if logo %} centered{% endif %}">
    {% block brand_content %} {%- if logo_url %}
    <div class="sidebar-logo-container">
        <a href="{{ pathto(master_doc) }}"><img class="sidebar-logo" src="{{ logo_url }}" alt="Logo" /></a>
    </div>
    {%- endif %} {%- if theme_light_logo and theme_dark_logo %}
    <div class="sidebar-logo-container" style="margin: .5rem 1em .5rem 0">
        <img class="sidebar-logo only-light" src="{{ pathto('_static/' + theme_light_logo, 1) }}" alt="logo" />
        <img class="sidebar-logo only-dark" src="{{ pathto('_static/' + theme_dark_logo, 1) }}" alt="logo" />
    </div>
    {%- endif %}
    <!-- <span class="sidebar-brand-text">{{ project }}</span> -->

    {% endblock brand_content %}
</div>

<!-- Dropdown for different versions of the viser docs. Slightly hacky. -->
<div style="padding: 0 1em;">
    <script>
      var viserDocsVersionsPopulated = false;

      function viserMemoizeHelper(fn) {
        const cacheKey = fn.name || 'memoizedFunction';
        const ttl = 3 * 60 * 1000; // 3 minutes in milliseconds.

        return async function(...args) {
            const now = Date.now();
            const cache = JSON.parse(localStorage.getItem(cacheKey)) || {};
            if (cache.timestamp && (now - cache.timestamp < ttl)) {
                console.log("Using cached value");
                return cache.value;
            }
            const value = await fn(...args);
            if (value === null) {
              console.log("Using cached value (failed to recompute)");
              return cache.value
            }
            localStorage.setItem(cacheKey, JSON.stringify({ value, timestamp: now }));
            return value;
        };
      }
      async function getVersionListViaGithubApi() {
        console.log("Polling GitHub REST API");
        const response = await fetch(
          "https://api.github.com/repos/nerfstudio-project/viser/contents/versions?ref=gh-pages",
        );
        if (await response.status === 403) {
            console.error(await response.json());
            return null;
        }
        return await response.json();
      }
      async function viserDocsPopulateVersionDropDown () {
        // Load the version list lazily... reduces likelihood of running into GitHub API rate limits.
        if (viserDocsVersionsPopulated) {
          return;
        }
        viserDocsVersionsPopulated = true;

        // Populate the version list by polling the GitHub REST API.
        console.log("Populating docs version list!")
        const data = viserMemoizeHelper(getVersionListViaGithubApi)();
        let htmlString = "<ul style='margin: 0.5rem 0 0 0'>";
        htmlString += `<li><a href="https://viser.studio/latest">latest</a></li>`;
        for (let file of data) {
          htmlString += `<li><a href="https://viser.studio/${file.path}">${file.name}</a></li>`;
        }

        htmlString += "</ul>";
        document.getElementById("version-dropdown").innerHTML =
          htmlString;
      }
    </script>
    <details
        style="padding: 0.5rem; background: var(--color-background-primary); border-radius: 0.5rem; border: 1px solid var(--color-sidebar-background-border);"
        ontoggle="viserDocsPopulateVersionDropDown()"
    >
    <summary style="cursor: pointer;"><strong>Version:</strong> <em>{{ version }}</em></summary>
      <div id="version-dropdown"></div>
    </details>
    <!-- End dropdown -->
</div>

<div style="text-align: left; padding: 1em">
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <a class="github-button" href="https://github.com/nerfstudio-project/viser"
        data-color-scheme="no-preference: light; light: light; dark: light;" data-size="large" data-show-count="true"
        aria-label="Download buttons/github-buttons on GitHub">
        Github
    </a>
</div>
